<!DOCTYPE html>
<html lang="en">
	<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="fXCqEVcHdJt50axIq7sCTxtZUh5gDHkj2usDwI_66gE" />
  <title>HTTP与缓存相关的头部信息</title>
  <meta name="description" content="1. HTTP headers简介">

 <!--  
   -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href= "/">
  <link rel="alternate" type="application/rss+xml" title="FrozenMap" href="/feed.xml">
  
  
</head>

	<body>
		<header class="site-header" role="banner" style="border-top:0px">
  <div class="wrapper">
    <a class="site-title" href="/">Home</a>
    <!-- <img src="/assets/Labtocat.png" width="43"> -->
    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>
      
      <div class="trigger">
          <a class="page-link" href="/about/">About</a>
          <!-- <a class="page-link" href="/donate">Donate</a> -->
          <a class="page-link" href="/feed.xml">RSS</a>
      </div>
    </nav>
  </div>
</header>
		<main class="page-content" aria-label="Content">
			<div class="wrapper">
				<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<header class="post-header">
		<h1 class="post-title" itemprop="name headline">
			HTTP与缓存相关的头部信息
		</h1>
		<p class="post-meta">
			<span><time datetime="2017-05-01T00:00:00+08:00" itemprop="datePublished">
				May 1, 2017</time> • </span>
			<span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href=http://localhost:4000>FrozenMap</a></span>
		</p>
	</header>
	<div class="post-content" itemprop="articleBody">
		<h1 id="http-headers">1. HTTP headers简介</h1>

<p>HTTP是一个应用层协议，由请求和响应构成。和其他很多数据格式一样，请求和响应由<strong>头部</strong>和<strong>数据</strong>组成，</p>

<p><br /></p>

<table>
  <thead>
    <tr>
      <th>常见请求头</th>
      <th>意义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Accept: text/html; image/webp; <em>/</em>	浏览器可接收的类型</td>
      <td>Accept-Encoding: gzip,compress 	浏览器可接收的压缩编码类型</td>
    </tr>
    <tr>
      <td>If-Modified-Since: Mon, 1 Aug 2016 18:23:51 GMT</td>
      <td>页面缓存时间</td>
    </tr>
    <tr>
      <td>Cache-Control：max-age=300</td>
      <td>缓存的最长时间 300s</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<table>
  <thead>
    <tr>
      <th>常见响应头</th>
      <th>意义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Content-Encoding: gzip</td>
      <td>服务器发送的压缩编码方式</td>
    </tr>
    <tr>
      <td>Content-Length: 80</td>
      <td>服务器发送显示的字节码长度</td>
    </tr>
    <tr>
      <td>Content-Type: text/html; charset=UTF-8</td>
      <td>服务器发送内容的类型和编码类型</td>
    </tr>
    <tr>
      <td>Last-Modified: Tue, 11 Jul 2000 18:23:51GMT</td>
      <td>服务器最后一次修改的时间</td>
    </tr>
    <tr>
      <td>Date:Mon, 01 Aug 2016 13:38:43 GMT</td>
      <td>资源起始时间</td>
    </tr>
    <tr>
      <td>Expires:Mon, 01 Aug 2016 13:38:53 GMT</td>
      <td>资源过期时间</td>
    </tr>
    <tr>
      <td>ETag:W/”578303987844e7989822712c1e153fc9”</td>
      <td>资源实体的标识(唯一标识，类似md5值，文件有修改md5就不一样)</td>
    </tr>
    <tr>
      <td>Cache-Control: max-age=10</td>
      <td>缓存时间</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h2 id="section">2. 与缓存相关的头部信息</h2>

<p>在请求静态文件的时候，由于这些文件不经常变化，因此把静态文件储起来是一种优化用户浏览体验的方法，同时也可以释放链路资源，缓解网络压力。</p>

<p>那么，应当如何确定缓存文件的有效时间呢？对此，我们需要用到HTTP头中的Expires和Cache-Control。</p>

<p><strong>2.1.1 Expires</strong></p>

<p>当客户端第一次访问一个文件资源的时候，服务端在返回资源内容的同时也返回了：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Expires: Mon, 1 Aug 2016 22:43:02 GMT
</code></pre>
</div>

<p>也就是服务端告诉浏览器，先把这个文件缓存起来，在这个过期时间之前，该文件都不会变化了。</p>

<p>下一次浏览器又要访问这个资源，并且访问的时间在<code class="highlighter-rouge">Mon, 1 Aug 2016 22:43:02 GMT</code>之前，那浏览器就不去服务器那边获取文件了，而是直接从缓存中取文件。</p>

<p><strong>2.1.2 Cache-Control</strong></p>

<p>由于Expires给定的是绝对时间，而客户端的系统时间可以由用户任意修改，比如Expires设定的过期时间是</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Mon, 1 Aug 2016 22:43:02 GMT
</code></pre>
</div>

<p>现在用户把系统时间改为</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Tue, 2 Aug 2016 22:43:02 GMT
</code></pre>
</div>

<p>则缓存会被判为过期（虽然实际上还没到那个时间）。因此在HTTP1.1中引入了Cache-Control，这就是一个相对时间，比如</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Cache-Control: max-age=80
</code></pre>
</div>

<p>那就是说这份缓存的有效期是80秒，而没有给定过期的绝对时间。</p>

<p>由于Cache-Control是HTTP1.1中才有的，因此可能会有Expires和Cache-Control同时出现的情况，这时以Cache-Control为准。</p>

<p><strong>2.2 Last-Modified / If-Modified-Since</strong></p>

<p>现在有另外一个问题，服务端有个文件可能会更新，因此希望客户端时不时过来问一下这个文件是否过期。</p>

<p>如果没有过期，服务端不返回数据给浏览器，只返回304状态码，告诉浏览器目前的缓存还没有过期，然后浏览器继续使用已有缓存。</p>

<p>这个就叫做条件请求。这里就要用到以下两个头部信息</p>

<ul>
  <li>Last-Modified	(response header)</li>
  <li>If-Modified-Since	(request header)</li>
</ul>

<p>以上一小节的响应头和请求头为例，浏览器第一次请求资源的时候，服务端返回资源内容，同时也返回了</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Last-Modified:Mon, 01 Aug 2016 13:48:44 GMT
</code></pre>
</div>

<p>也就是服务端在告诉客户端这个文件在服务器上的最后修改时间。</p>

<p>浏览器第二次访问的时候（假设这里没有设置Expires或者Cache-Control）。那么浏览器在访问资源的时候会在请求头上带上</p>

<div class="highlighter-rouge"><pre class="highlight"><code>If-Modified-Since:Mon, 01 Aug 2016 13:48:44 GMT
</code></pre>
</div>

<p>服务端收到后对比目前文件的最后修改时间和该请求头的信息，如果没有修改，那就直接返回304给浏览器，而不返回实际资源。如果有变化了，就返回200，并且带上新的资源内容。</p>

<p><strong>2.3 Etag / If-None-Match</strong></p>

<p>条件请求还有另外一种方法——打标签，也就是使用Etag。</p>

<p>道理和上一小节类似：</p>

<ul>
  <li>第一次拿到资源的时候，服务器的响应头中包含了Etag，用来作为时间标签</li>
  <li>下一次浏览器再次请求资源的时候会把原来的Etag标签带上（在请求头中变成了If-None-Match）作为校验标准，</li>
  <li>若这个文件如果发生了改变，则Etag也会改变。</li>
  <li>服务器对比浏览器请求头中的的If-None-Match：
    <ul>
      <li>如果相同就返回304，而不返回实际资源</li>
      <li>如果不同，就返回200和新的资源。</li>
    </ul>
  </li>
</ul>

<p>由于Etag需要通过服务器计算得出，每次都进行计算需要额外的开销，有时候这也是一种负担。</p>

<p><br /></p>

<h2 id="section-1">3. 实例</h2>

<p>下面以第2篇参考资料为例。在chrome中打开开发者工具的Network，然后进入<a href="http://www.cnblogs.com/yjf512/p/3244882.html">http://www.cnblogs.com/yjf512/p/3244882.html</a>，选择名为<code class="highlighter-rouge">3244882.html</code>的文件，可以看到其Response Headers中有如下内容：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Cache-Control:private, max-age=10
Connection:keep-alive
Content-Encoding:gzip
Content-Type:text/html; charset=utf-8
Date:Mon, 01 Aug 2016 13:48:44 GMT
Expires:Mon, 01 Aug 2016 13:48:54 GMT
Last-Modified:Mon, 01 Aug 2016 13:48:44 GMT
Transfer-Encoding:chunked
Vary:Accept-Encoding
X-UA-Compatible:IE=10
</code></pre>
</div>

<p>第1行的<code class="highlighter-rouge">Cache-Control:private, max-age=10</code>，表示有效时间为10s，且其优先级高于<code class="highlighter-rouge">Expires</code>。响应头中出现了<code class="highlighter-rouge">private</code>，其作用是通知浏览器只针对单个用户进行缓存，且可以具体指定某个字段，如<code class="highlighter-rouge">private–"username"</code>。</p>

<p>第2行的<code class="highlighter-rouge">Keep-Alive</code>功能使客户端到服务器端的连接持续有效。当出现对服务器的后继请求时，<code class="highlighter-rouge">Keep-Alive</code>功能避免了重新建立连接，即认为之前的连接还是有效的。</p>

<p>第3行表示响应的压缩方式。压缩后再传输可以提高效率。</p>

<p>第4行表示响应的文件类型和字符编码方式。</p>

<p>第5行的<code class="highlighter-rouge">Date</code>表示生成文件的绝对时间。</p>

<p>第6行<code class="highlighter-rouge">Expires</code>表示文件过期的绝对时间。同时上面也提到了，其优先级低于<code class="highlighter-rouge">Cache-Control</code>。</p>

<p>第7行的<code class="highlighter-rouge">Last-Modified</code>是服务器告诉浏览器该文件的最后修改时间。</p>

<p>综上可以看出，该页面的缓存有效时间是10秒。如果不清空缓存，在2016.08.01的13:48:44~13:48:54这个时间段中再次访问服务器，则不会再得到新的页面，而是直接呈现本地缓存。</p>

<p><br /></p>

<h2 id="section-2">4.参考文献</h2>

<ul>
  <li><a href="http://blog.csdn.net/zhsh87/article/details/8186753">HTTP缓存相关的概念</a></li>
  <li><a href="http://www.cnblogs.com/yjf512/p/3244882.html">HTTP缓存相关头</a></li>
</ul>

<p><br /></p>

<p>本文地址：<a href="https://jjayyyyyyy.github.io/2017/05/01/http_headers.html">https://jjayyyyyyy.github.io/2017/05/01/http_headers.html</a></p>

<h6>注：本文最初整理于20160801。接下来将会陆续整理一些以前的学习笔记。</h6>

<p>(END)</p>

<hr />

<h2 id="section-3">相关阅读</h2>

<ul>
  <li><a href="https://book.douban.com/subject/10746113/">HTTP权威指南</a></li>
</ul>

	</div>

	<div>
		<br/>
		<!-- great thanks to https://www.rrssb.ml/ -->
		<link rel="stylesheet" href="/css/rrssb/css/rrssb.css" />
		<ul class="rrssb-buttons clearfix" style="display: flex; justify-content: flex-end;">
			<li class="rrssb-facebook small" data-initwidth="14.285714285714286" data-size="67" style="width: 42px;">
				<a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2017/05/01/HTTP_headers.html" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
					<span class="rrssb-icon">
						<svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="29" height="29" viewBox="0 0 29 29">
							<path d="M26.4 0H2.6C1.714 0 0 1.715 0 2.6v23.8c0 .884 1.715 2.6 2.6 2.6h12.393V17.988h-3.996v-3.98h3.997v-3.062c0-3.746 2.835-5.97 6.177-5.97 1.6 0 2.444.173 2.845.226v3.792H21.18c-1.817 0-2.156.9-2.156 2.168v2.847h5.045l-.66 3.978h-4.386V29H26.4c.884 0 2.6-1.716 2.6-2.6V2.6c0-.885-1.716-2.6-2.6-2.6z" fill-rule="evenodd" class="cls-2"/>
						</svg>
					</span>
					<span class="rrssb-text">facebook</span>
				</a>
			</li>
			<li class="rrssb-twitter small" data-initwidth="14.285714285714286" data-size="53" style="width: 42px;">
				<a href="https://twitter.com/intent/tweet?text=HTTP与缓存相关的头部信息%20%20http://localhost:4000/2017/05/01/HTTP_headers.html" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
					<span class="rrssb-icon">
						<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28">
							<path d="M24.253 8.756C24.69 17.08 18.297 24.182 9.97 24.62c-3.122.162-6.22-.646-8.86-2.32 2.702.18 5.375-.648 7.507-2.32-2.072-.248-3.818-1.662-4.49-3.64.802.13 1.62.077 2.4-.154-2.482-.466-4.312-2.586-4.412-5.11.688.276 1.426.408 2.168.387-2.135-1.65-2.73-4.62-1.394-6.965C5.574 7.816 9.54 9.84 13.802 10.07c-.842-2.738.694-5.64 3.434-6.48 2.018-.624 4.212.043 5.546 1.682 1.186-.213 2.318-.662 3.33-1.317-.386 1.256-1.248 2.312-2.4 2.942 1.048-.106 2.07-.394 3.02-.85-.458 1.182-1.343 2.15-2.48 2.71z"/>
						</svg>
					</span>
					<span class="rrssb-text">twitter</span>
				</a>
			</li>
			<li class="rrssb-googleplus small" data-initwidth="14.285714285714286" data-size="59" style="width: 42px;">
				<a href="https://plus.google.com/share?url=http://localhost:4000/2017/05/01/HTTP_headers.html" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
					<span class="rrssb-icon">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
							<path d="M21 8.29h-1.95v2.6h-2.6v1.82h2.6v2.6H21v-2.6h2.6v-1.885H21V8.29zM7.614 10.306v2.925h3.9c-.26 1.69-1.755 2.925-3.9 2.925-2.34 0-4.29-2.016-4.29-4.354s1.885-4.353 4.29-4.353c1.104 0 2.014.326 2.794 1.105l2.08-2.08c-1.3-1.17-2.924-1.883-4.874-1.883C3.65 4.586.4 7.835.4 11.8s3.25 7.212 7.214 7.212c4.224 0 6.953-2.988 6.953-7.082 0-.52-.065-1.104-.13-1.624H7.614z"/>
						</svg>
					</span>
					<span class="rrssb-text">google+</span>
				</a>
			</li>
		</ul>
		<br/>
	</div>

	<div style="border-top: dotted #e8e8e8; border-width: 1px 0; padding-top: 10px;">
	</div>

	<div align="center">
		<a rel="cc-license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
			<img alt="Creative Commons License" style="border-width:0" src="https://img.shields.io/badge/%20%20%20CC%20%20%20-BY--NC--SA-brightgreen.svg" /></a>
		<a rel="mit-license" href="http://opensource.org/licenses/mit-license.php">
			<img alt="MIT-License" style="border-width:0" src="https://img.shields.io/badge/License-MIT%20License-blue.svg" /></a>
		<!-- <p>转载请保留作者和出处, 包括以上许可证信息。</p> -->
		<br/><br/><br/>
	</div>

	<div>
		<noscript>Please enable JavaScript to view the comment form powered by <a href="https://commentit.io/">Comm(ent|it)</a></noscript>
		<div id="commentit"></div>
		<script type="text/javascript">
			/** CONFIGURATION VARIABLES **/
			var commentitUsername = 'jJayyyyyyy';
			var commentitRepo = 'jJayyyyyyy/jJayyyyyyy.github.io';
			var commentitPath = '_posts/2017-05-01-HTTP_headers.md';

			/** DON'T EDIT FOLLOWING LINES **/
			(function() {
				var commentit = document.createElement('script');
				commentit.type = 'text/javascript';
				commentit.async = true;
				commentit.src = 'https://commentit.io/static/embed/dist/commentit.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(commentit);
			})();
		</script>
		
		
	</div>

</article>

			</div>
		</main>
	</body>
</html>
