<!DOCTYPE html>
<html lang="en">
	<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="fXCqEVcHdJt50axIq7sCTxtZUh5gDHkj2usDwI_66gE" />
  <title>文字的颜色</title>
  <meta name="description" content="本文代码在这里 https://github.com/jJayyyyyyy/bmp_maker">

 <!--  
   -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href= "/">
  <link rel="alternate" type="application/rss+xml" title="FrozenMap" href="/feed.xml">
  
  
</head>

	<body>
		<header class="site-header" role="banner" style="border-top:0px">
  <div class="wrapper">
    <a class="site-title" href="/">Home</a>
    <!-- <img src="/assets/Labtocat.png" width="43"> -->
    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>
      
      <div class="trigger">
          <a class="page-link" href="/about/">About</a>
          <!-- <a class="page-link" href="/donate">Donate</a> -->
          <a class="page-link" href="/feed.xml">RSS</a>
      </div>
    </nav>
  </div>
</header>
		<main class="page-content" aria-label="Content">
			<div class="wrapper">
				<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<header class="post-header">
		<h1 class="post-title" itemprop="name headline">
			文字的颜色
		</h1>
		<p class="post-meta">
			<span><time datetime="2017-04-10T00:00:00+08:00" itemprop="datePublished">
				Apr 10, 2017</time> • </span>
			<span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href=http://localhost:4000>FrozenMap</a></span>
		</p>
	</header>
	<div class="post-content" itemprop="articleBody">
		<p>本文代码在这里 <a href="https://github.com/jJayyyyyyy/bmp_maker">https://github.com/jJayyyyyyy/bmp_maker</a></p>

<h2 id="section">1.序</h2>

<p>无论什么语言，每一段文字都有自己的颜色。比如程序员最熟悉的<code class="highlighter-rouge">hello world.</code>，它的颜色是这样的：</p>

<p><img src="https://raw.githubusercontent.com/jJayyyyyyy/bmp_maker/master/assets/expanded_demo1.bmp" alt="hello world" /></p>

<p>又比如<a href="https://github.com/jJayyyyyyy/bmp_maker/blob/master/assets/ym_face.txt">这个</a>由字符搭出来的姚明脸，其颜色是这样的</p>

<p><img src="https://raw.githubusercontent.com/jJayyyyyyy/bmp_maker/master/assets/expanded_demo2.bmp" alt="ym face" /></p>

<p>是不是很神奇lol</p>

<p><br /></p>

<h2 id="section-1">2.原理</h2>

<p>创意来自<a href="https://www.zhihu.com/question/51314788/answer/155265634">KaitoHH</a>，这哥们写了一个<a href="https://github.com/KaitoHH/AnyCodeToBmp">AnyCodeToBmp</a>，根据名字可以看出，这是一个把代码变成BMP图像的工具。</p>

<p>我们知道，在计算机中可以有很多种方式来表示颜色（如本文用到的<code class="highlighter-rouge">RGB</code>颜色空间），也有很多种图像格式（如JPEG, PNG, 本文用到的是BMP格式）。如果用文本编辑器打开一张图片，可以看到里面是一连串的十六进制的数字，这就是图片在计算机里保存的形式。当我们换用<code class="highlighter-rouge">画图</code>或者其他软件打开它，就相当于把这些数字解码，还原成图片。</p>

<p>因此，我们要做的就是把代码文字当成了RGB颜色，然后在文件开头写上必要的信息，将该文件标识为BMP图像，让看图软件能够识别并呈现我们的“图片”。</p>

<p>更为神奇的是，如果我们用文本编辑器打开这些“图片”，除了开头的乱码，剩下的就是我们原来写入的文字！</p>

<p><a href="https://github.com/KaitoHH/AnyCodeToBmp">KaitoHH</a>的工具是用C写的，既然知道了原理，我们不妨用Python来重写一遍。值得注意的是，C可以很方便的操作底层的bit啊byte啊，而Python本来不是干这个的，所以我们不必局限于原来的实现方法，参考原理和思路即可。</p>

<p><br /></p>

<h2 id="section-2">3.实现</h2>

<p>BMP图像可以简单地由两部分组成：</p>

<ul>
  <li>文件头，<code class="highlighter-rouge">Headers(54bytes)</code> = <code class="highlighter-rouge">BMP Header(14 bytes)</code> + <code class="highlighter-rouge">DIB(40 bytes)</code></li>
  <li>图片数据，<code class="highlighter-rouge">Pixel Array</code>, 也即<code class="highlighter-rouge">Bitmap Data</code></li>
</ul>

<p>具体的对应关系可以查看<a href="https://en.wikipedia.org/wiki/BMP_file_format">wikipedia: BMP file format</a>.</p>

<p>我们需要在文件头中写入以下信息：</p>

<ul>
  <li>文件总大小<code class="highlighter-rouge">total_size</code>，对应的Offset是<code class="highlighter-rouge">0x02</code>，长度4字节</li>
  <li>图片宽度<code class="highlighter-rouge">width</code>，对应Offset是<code class="highlighter-rouge">0x12</code>，长度4字节</li>
  <li>图片高度<code class="highlighter-rouge">height</code>，对应Offset是<code class="highlighter-rouge">0x16</code>，长度4字节</li>
  <li>图片数据大小<code class="highlighter-rouge">raw_size</code>，对应<code class="highlighter-rouge">0x22</code>，长度4字节</li>
</ul>

<p>这些也就是可变的部分，其他地方写入固定数值即可，注意BMP采用<a href="https://en.wikipedia.org/wiki/Endianness">小端序(little-endian)</a></p>

<p>然后将编码后的文字写到文件头后面，就可以得到计算机能够识别的BMP图像了。</p>

<p><br /></p>

<h2 id="section-3">4.实例</h2>

<p>看完3是不是觉得还有点抽象？没关系，下面我们来看一个实例。简单起见，我们来“画出”一开始的<code class="highlighter-rouge">hello world.</code>（注意，这段字符串长度为<code class="highlighter-rouge">10</code>）。</p>

<p>首先，用十六进制打开图像后，我们将看到以下内容：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>424d 4200 0000 0000 0000 3600 0000 2800
0000 0400 0000 0100 0000 0100 1800 0000
0000 0c00 0000 0000 0000 0000 0000 0000
0000 0000 0000 6865 6c6c 6f20 776f 726c
642e 
</code></pre>
</div>

<p>然后我们来分段说明：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>424d		#固定，用ascii表示的"BM"
4200 0000	#total_size, 0x42 = 66 = 54 + 12(字符串长度10)
0000		#固定
0000		#固定
3600 0000	#固定, header_size, 0x36 = 54 = 14 + 40
2800 0000	#DIB_size, 0x28 = 40
0400 0000	#width, 0x04 = 4, 注意width取4的整数倍
0100 0000	#height, 0x01 = 1
0100		#固定
1800		#固定
0000 0000	#固定
0c00 0000	#raw_size, 0x0c = 12
0000 0000	#固定
0000 0000	#固定
0000 0000	#固定
0000 0000	#固定
</code></pre>
</div>

<p>以上就是整个<code class="highlighter-rouge">Headers</code>的内容。剩下的就是颜色信息，逐个对应了字符串”hello world.”的ASCII码。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>6865 6c6c 6f20 776f 726c 642e
</code></pre>
</div>

<p>这样拆解之后，结构是不是清晰了很多呢？如果要画出另外的文字，只需要修改第3节中对应的部分即可。需要注意的是，width应取4的整数倍。而在RGB空间中，每个像素pixel为3个字节（红+蓝+绿，各占一字节），因此<code class="highlighter-rouge">raw_size</code>应该是<code class="highlighter-rouge">12</code>的整数倍，补齐的方法可以是在末尾添加<code class="highlighter-rouge"> </code>或者<code class="highlighter-rouge">\n</code></p>

<p><br /></p>

<h2 id="section-4">5.跋</h2>

<p>偷偷地告诉你一个秘密，中文博大精深，其色彩亦是绚烂多姿。</p>

<p>最后，有一篇文章的颜色是这样的(未放大的图像在<a href="https://github.com/jJayyyyyyy/bmp_maker/blob/master/assets/demo3.bmp">这里</a>)</p>

<p><img src="https://raw.githubusercontent.com/jJayyyyyyy/bmp_maker/master/assets/expanded_demo3.bmp" alt="guess it" /></p>

<p>你能猜出这是哪一篇文章吗-( ゜- ゜)つロ</p>

<p><br /></p>

<p>(END)</p>

<hr />

<h2 id="section-5">相关阅读</h2>

<ul>
  <li>BMP means BitMap</li>
  <li>DIB means Device Independent Bitmap</li>
  <li><a href="https://github.com/KaitoHH/AnyCodeToBmp">KaitoHH: AnyCodeToBmp</a></li>
  <li><a href="https://en.wikipedia.org/wiki/BMP_file_format">Wikipedia: BMP</a></li>
  <li><a href="http://www.96yx.com/tool/ASC2.htm">ASCII</a></li>
  <li>bytes
    <ul>
      <li><a href="http://stackoverflow.com/questions/21017698/converting-int-to-bytes-in-python-3">Stack Overflow: int_to_bytes</a></li>
      <li><a href="https://docs.python.org/3/library/functions.html#bytes">Python Docs: bytes</a></li>
    </ul>
  </li>
  <li>others
    <ul>
      <li><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431918785710e86a1a120ce04925bae155012c7fc71e000">liaoxuefeng: 字符串和编码</a></li>
      <li><a href="https://en.wikibooks.org/wiki/Python_Imaging_Library/Editing_Pixels">PIL: Editing_Pixels</a></li>
      <li><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014320027235877860c87af5544f25a8deeb55141d60c5000#0">liaoxuefeng: PIL</a></li>
      <li><a href="http://www.zxjsq.net/">在线计算器</a></li>
    </ul>
  </li>
</ul>

	</div>

	<div>
		<br/>
		<!-- great thanks to https://www.rrssb.ml/ -->
		<link rel="stylesheet" href="/css/rrssb/css/rrssb.css" />
		<ul class="rrssb-buttons clearfix" style="display: flex; justify-content: flex-end;">
			<li class="rrssb-facebook small" data-initwidth="14.285714285714286" data-size="67" style="width: 42px;">
				<a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2017/04/10/bmp_maker.html" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
					<span class="rrssb-icon">
						<svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="29" height="29" viewBox="0 0 29 29">
							<path d="M26.4 0H2.6C1.714 0 0 1.715 0 2.6v23.8c0 .884 1.715 2.6 2.6 2.6h12.393V17.988h-3.996v-3.98h3.997v-3.062c0-3.746 2.835-5.97 6.177-5.97 1.6 0 2.444.173 2.845.226v3.792H21.18c-1.817 0-2.156.9-2.156 2.168v2.847h5.045l-.66 3.978h-4.386V29H26.4c.884 0 2.6-1.716 2.6-2.6V2.6c0-.885-1.716-2.6-2.6-2.6z" fill-rule="evenodd" class="cls-2"/>
						</svg>
					</span>
					<span class="rrssb-text">facebook</span>
				</a>
			</li>
			<li class="rrssb-twitter small" data-initwidth="14.285714285714286" data-size="53" style="width: 42px;">
				<a href="https://twitter.com/intent/tweet?text=文字的颜色%20%20http://localhost:4000/2017/04/10/bmp_maker.html" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
					<span class="rrssb-icon">
						<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28">
							<path d="M24.253 8.756C24.69 17.08 18.297 24.182 9.97 24.62c-3.122.162-6.22-.646-8.86-2.32 2.702.18 5.375-.648 7.507-2.32-2.072-.248-3.818-1.662-4.49-3.64.802.13 1.62.077 2.4-.154-2.482-.466-4.312-2.586-4.412-5.11.688.276 1.426.408 2.168.387-2.135-1.65-2.73-4.62-1.394-6.965C5.574 7.816 9.54 9.84 13.802 10.07c-.842-2.738.694-5.64 3.434-6.48 2.018-.624 4.212.043 5.546 1.682 1.186-.213 2.318-.662 3.33-1.317-.386 1.256-1.248 2.312-2.4 2.942 1.048-.106 2.07-.394 3.02-.85-.458 1.182-1.343 2.15-2.48 2.71z"/>
						</svg>
					</span>
					<span class="rrssb-text">twitter</span>
				</a>
			</li>
			<li class="rrssb-googleplus small" data-initwidth="14.285714285714286" data-size="59" style="width: 42px;">
				<a href="https://plus.google.com/share?url=http://localhost:4000/2017/04/10/bmp_maker.html" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
					<span class="rrssb-icon">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
							<path d="M21 8.29h-1.95v2.6h-2.6v1.82h2.6v2.6H21v-2.6h2.6v-1.885H21V8.29zM7.614 10.306v2.925h3.9c-.26 1.69-1.755 2.925-3.9 2.925-2.34 0-4.29-2.016-4.29-4.354s1.885-4.353 4.29-4.353c1.104 0 2.014.326 2.794 1.105l2.08-2.08c-1.3-1.17-2.924-1.883-4.874-1.883C3.65 4.586.4 7.835.4 11.8s3.25 7.212 7.214 7.212c4.224 0 6.953-2.988 6.953-7.082 0-.52-.065-1.104-.13-1.624H7.614z"/>
						</svg>
					</span>
					<span class="rrssb-text">google+</span>
				</a>
			</li>
		</ul>
		<br/>
	</div>

	<div style="border-top: dotted #e8e8e8; border-width: 1px 0; padding-top: 10px;">
	</div>

	<div align="center">
		<a rel="cc-license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
			<img alt="Creative Commons License" style="border-width:0" src="https://img.shields.io/badge/%20%20%20CC%20%20%20-BY--NC--SA-brightgreen.svg" /></a>
		<a rel="mit-license" href="http://opensource.org/licenses/mit-license.php">
			<img alt="MIT-License" style="border-width:0" src="https://img.shields.io/badge/License-MIT%20License-blue.svg" /></a>
		<!-- <p>转载请保留作者和出处, 包括以上许可证信息。</p> -->
		<br/><br/><br/>
	</div>

	<div>
		<noscript>Please enable JavaScript to view the comment form powered by <a href="https://commentit.io/">Comm(ent|it)</a></noscript>
		<div id="commentit"></div>
		<script type="text/javascript">
			/** CONFIGURATION VARIABLES **/
			var commentitUsername = 'jJayyyyyyy';
			var commentitRepo = 'jJayyyyyyy/jJayyyyyyy.github.io';
			var commentitPath = '_posts/2017-04-10-bmp_maker.md';

			/** DON'T EDIT FOLLOWING LINES **/
			(function() {
				var commentit = document.createElement('script');
				commentit.type = 'text/javascript';
				commentit.async = true;
				commentit.src = 'https://commentit.io/static/embed/dist/commentit.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(commentit);
			})();
		</script>
		
		
	</div>

</article>

			</div>
		</main>
	</body>
</html>
