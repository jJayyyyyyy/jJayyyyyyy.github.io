<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="fXCqEVcHdJt50axIq7sCTxtZUh5gDHkj2usDwI_66gE" />
  <title>使用Python处理Excel数据</title>
  <meta name="description" content="1. 简介">

 <!--  
   -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href= "/">
  <link rel="alternate" type="application/rss+xml" title="FrozenMap" href="/feed.xml">
  
  
</head>

  <body>
    <header class="site-header" role="banner" style="border-top:0px">
  <div class="wrapper">
    <a class="site-title" href="/">Home</a>
    <!-- <img src="/assets/Labtocat.png" width="43"> -->
    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>
      
      <div class="trigger">
          <a class="page-link" href="/about/">About</a>
          <!-- <a class="page-link" href="/donate">Donate</a> -->
          <a class="page-link" href="/feed.xml">RSS</a>
      </div>
    </nav>
  </div>
</header>
    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">使用Python处理Excel数据</h1>
    <p class="post-meta"> <time datetime="2016-10-18T00:00:00+08:00" itemprop="datePublished">Oct 18, 2016</time>
      <!--  -->
        • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">FrozenMap</span></span>
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="section">1. 简介</h2>

<p>这篇文章将会介绍<a href="https://github.com/python-excel/xlrd">xlrd</a>和<a href="https://github.com/python-excel/xlwt">xlwt</a>，并利用它们进行Excel数据的读取和写入，以便实现复杂的但有规律的Excel数据处理逻辑。本文代码和示例托管于<a href="https://github.com/jJayyyyyyy/python-excel__demo">GitHub</a>，可供参考。</p>

<p><a href="https://github.com/python-excel/xlrd">xlrd</a>和<a href="https://github.com/python-excel/xlwt">xlwt</a>是两个基于python的库(Package)，它们能够处理<code class="highlighter-rouge">.xls</code>文件，前者可以读取Excel表格的数据，后者可以新建表格写入数据。</p>

<p>本文参考了<a href="https://github.com/python-excel/tutorial">python-excel tutorial</a>，并结合实践应用整理而成。内容仅针对数据处理，不包括格式的设置。更多内容可参考<a href="http://www.python-excel.org/">python-excel.org</a>及其<a href="https://github.com/python-excel">GitHub</a>项目页。在此感谢<a href="https://github.com/cjw296">cjw296</a>和<a href="https://github.com/sjmachin">sjmachin</a>两位同学的成果~</p>

<p>ps: 其文档中存在部分小错误，整体理解即可。</p>

<p><br /></p>

<h2 id="package">2. 为什么要用这两个package</h2>

<ol>
  <li>
    <p>不知道你有没有这种经历：自己对于Excel的掌握一般，只会用菜单栏的基本功能对表格数据进行处理。但是如果更复杂的处理逻辑就非常蛋疼了，用基本功能很难描述，怎么问度娘都得不到合适的公式，对于VBA也不甚了解（反正我是完全不懂啊=.=）。但是需要处理的数据有很多，一次次地重复劳动简直是一种折磨啊。。</p>

    <p>这时候就该<code class="highlighter-rouge">python-excel</code>出场了~我们要做的，就是把重复的但是有规律的数据处理动作，抽象成为固定的逻辑顺序，然后用python描述出来，这样即可一劳永逸。以后再遇到这个问题你就可以去泡一杯喝咖啡静静等待电脑帮你完成任务，而不用半天甚至整天都盯着屏幕一行一行地手动处理了。</p>
  </li>
  <li>
    <p>python方便灵活容易上手，不需要编译。开发省时，性能损失不大。</p>
  </li>
  <li>
    <p>这两个库的接口还行，其他的库没试过，可能有更好的。其次是有方便的接口可以读写某行某列，可以快速定位到某张表，某个单元格，etc…不需要自己重复造轮子。</p>
  </li>
</ol>

<p><br /></p>

<h2 id="section-1">3. 如何食用</h2>

<ol>
  <li>
    <p>第一步是安装<code class="highlighter-rouge">python2.7</code>或<code class="highlighter-rouge">python3.4</code>，本文代码基于后者。</p>

    <p>利用<a href="https://pypi.python.org/pypi/pip">pip</a>安装<code class="highlighter-rouge">xlrd</code>和<code class="highlighter-rouge">xlwt</code></p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>pip3 install xlrd xlwt
</code></pre>
    </div>

    <p>然后假设有如下这么一个表格<code class="highlighter-rouge">demo_read.xls</code></p>

    <table>
      <thead>
        <tr>
          <th style="text-align: left">Name</th>
          <th style="text-align: center">Age</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: left">Emily</td>
          <td style="text-align: center">10</td>
        </tr>
        <tr>
          <td style="text-align: left">Bob</td>
          <td style="text-align: center">11</td>
        </tr>
        <tr>
          <td style="text-align: left">Xiaoming</td>
          <td style="text-align: center">9</td>
        </tr>
        <tr>
          <td style="text-align: left">Monika</td>
          <td style="text-align: center">7</td>
        </tr>
        <tr>
          <td style="text-align: left">Steve</td>
          <td style="text-align: center">8</td>
        </tr>
      </tbody>
    </table>

    <p><br /></p>
  </li>
  <li>
    <p>读取数据</p>

    <p>首先引入模块</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">xlrd</span> <span class="kn">import</span> <span class="n">open_workbook</span>
</code></pre>
    </div>

    <p>其次实例化一个<code class="highlighter-rouge">open_workbook</code>对象，从<code class="highlighter-rouge">demo_read.xls</code>读取文件信息</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">wb</span> <span class="o">=</span> <span class="n">open_workbook</span><span class="p">(</span><span class="s">'demo_read.xls'</span><span class="p">)</span>
</code></pre>
    </div>

    <p>读取第一张表，得到表单名字，总行数和总列数</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">sheet_0</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">sheets</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">total_rows</span> <span class="o">=</span> <span class="n">sheet_0</span><span class="o">.</span><span class="n">nrows</span>
<span class="n">total_cols</span> <span class="o">=</span> <span class="n">sheet_0</span><span class="o">.</span><span class="n">ncols</span>
</code></pre>
    </div>

    <p>得到某个单元格的值，第2行第3列单元格坐标为(1, 2)</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">cell_value</span> <span class="o">=</span> <span class="n">sheet_0</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>写入数据</p>

    <p>首先引入模块</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">xlwt</span> <span class="kn">import</span> <span class="n">Workbook</span>
</code></pre>
    </div>

    <p>其次实例化一个<code class="highlighter-rouge">Workbook</code>对象，添加新表单</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">book</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">()</span>
<span class="n">sheet_new</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s">'Sheet_new'</span><span class="p">)</span>
</code></pre>
    </div>

    <p>结合3.2节，如果我们要复制一个表单，可以这么做</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sheet_0</span><span class="o">.</span><span class="n">nrows</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sheet_0</span><span class="o">.</span><span class="n">ncols</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">sheet_0</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="c"># write into the new sheet</span>
        <span class="n">sheet_new</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre>
    </div>

    <p>最后保存</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">'demo_write.xls'</span><span class="p">)</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>需要说明的是，读和写是两种不同的对象，只能通过中间变量联系，也就是3.3节中的<code class="highlighter-rouge">value</code>. 另外，如果是在windows下开发，有时候会出现莫名其妙的编码问题（cmd打印的时候）。</p>
  </li>
  <li>
    <p>如果想让电脑更懂你，就需要在你的代码中结合条件判断，循环语句，字符串的<code class="highlighter-rouge">len()</code>, <code class="highlighter-rouge">strip()</code>, <code class="highlighter-rouge">lstrip()</code>, <code class="highlighter-rouge">rstrip()</code>, <code class="highlighter-rouge">split()</code>, <code class="highlighter-rouge">replace()</code>等方法，如果掌握了<code class="highlighter-rouge">re</code>神器就更好了~</p>
  </li>
</ol>

<p>下面一章，我们就用实例来说明如何让电脑更懂你的需求。</p>

<p><br /></p>

<h2 id="section-2">4. 实例</h2>

<p>原来是结合工作任务写的一些脚本，由于涉及保密数据，所以需要处理一下。过两天更新。</p>

<p><br /></p>

<h2 id="section-3">5. 参考</h2>

<ol>
  <li>
    <p><a href="https://github.com/python-excel/tutorial">python-excel tutorial</a></p>
  </li>
  <li>
    <p><a href="http://www.liaoxuefeng.com">liaoxuefeng</a></p>
  </li>
</ol>

<p><br /></p>

<hr />

<p>写于20161018</p>

<p>20161023第一次完善和上传</p>

<p>20161024第二次更新：增加表格，增加参考文献</p>


  </div>

  <div>
    <br/><br/>
    <div style="border-top: dotted #e8e8e8; border-width: 1px 0; padding-top: 10px;"></div>
    <h2>License</h2>
    <p>
      The content of this project itself is licensed under the Creative Commons <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"> BY-NC-SA </a>, and the underlying source code used to format and display that content is licensed under the <a href="http://opensource.org/licenses/mit-license.php">MIT license</a>.
    </p>
    <p> 转载请保留作者和出处, 包括以上许可证信息, 谢谢!
  </div>

  
</article>

      </div>
    </main>
  </body>
</html>
